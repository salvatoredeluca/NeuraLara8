<?xml version="1.0"?>
<robot name="lara8" xmlns:xacro="http://wiki.ros.org/xacro" xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller" xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface" xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor" >
   
	<xacro:arg name="prefix" default="lara8_"/>
  	<xacro:arg name="parameter_file_name" default="lara8_kinematic_parameters_nominal"/>
	<xacro:arg name="dynamic_parameter_file_name" default="lara8_dynamic_parameters_nominal"/>
	<xacro:arg name="limits_file_name" default="lara8_limits"/>
	


  	<xacro:macro name="lara8_robot" params="prefix:=${prefix} 
                                         parameter_file_name:=lara8_kinematic_parameters_nominal 
                                        dynamic_parameter_file_name=lara8_dynamic_parameters_nominal 
                                        limits_file_name=lara8_limits
                                        *origin
                                        name
										parent
										use_vision
										not_gazebo
										
                                        initial_positions_file:=
										
                                        ">

	<xacro:include filename="$(find robot_description)/lara8/urdf/${parameter_file_name}.xacro" />
	<xacro:include filename="$(find robot_description)/lara8/urdf/${dynamic_parameter_file_name}.xacro" />
	<xacro:include filename="$(find robot_description)/lara8/urdf/${limits_file_name}.xacro" />

	

	 <xacro:if value="${not_gazebo}"> 
		<xacro:include filename="$(find moveit_lara8_moveit_config)/config/lara8_ros2_control.xacro" />
    	<xacro:lara8_ros2_control name="${name}" initial_positions_file="${initial_positions_file}" prefix="${prefix}"/> 
	</xacro:if>

	

<!-- values not correct. 12/05/2022 heitmann-->

<!-- ============================ BASE ================================= -->

		
		<joint name="${prefix}root_joint" type="fixed"> 
			<xacro:insert_block name="origin" />
			
			<axis xyz="0 0 1" />
			<parent link="${parent}"/>
			<child link="${prefix}link0"/>
		</joint>

		<link name="${prefix}link0"> 
		<inertial>
			<mass value="${mass_0}" />
			<origin rpy="0 0 0" xyz="${cog_x_0} ${cog_y_0} ${cog_z_0}" />
			<inertia ixx="${i_xx_0}" ixy="${i_xy_0}"  ixz="${i_xz_0}"
									 iyy="${i_yy_0}"  iyz="${i_yz_0}"
													  izz="${i_zz_0}" />
		</inertial>
		<visual>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/meshes/Link0_body.stl" />
				</geometry>
			<material name="white"/>
		</visual>
		<visual>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/meshes/Link0_connector.stl" />
				</geometry>
			<material name="white"/>
		</visual>
		<collision>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/collision/Link0_body.stl" />
				</geometry>
			<material name="white"/>
		</collision>
		</link>

<!-- ============================ DOF1 ================================= -->

		<joint name="${prefix}joint1" type="revolute"> 
			<origin rpy="${R1} ${P1} ${Y1}" xyz="${x1} ${y1} ${z1}" />
			<axis xyz="0 -1 0" />
			<limit lower="${lower_joint_limit_1}" upper="${upper_joint_limit_1}" effort="${torque_limit_1}" velocity="${joint_velocity_limit_1}" />
			<parent link="${prefix}link0"/>
			<child link="${prefix}link1"/>
		</joint>

		<link name="${prefix}link1">  
		<inertial> 
			<mass value="${mass_1}" />
			<origin rpy="0 0 0" xyz="${cog_x_1} ${cog_y_1} ${cog_z_1}" />
			<inertia ixx="${i_xx_1}" ixy="${i_xy_1}"  ixz="${i_xz_1}"
									 iyy="${i_yy_1}"  iyz="${i_yz_1}"
													  izz="${i_zz_1}" />
		</inertial>
		<visual>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/meshes/Link1_body.stl" />
				</geometry>
			<material name="white"/>
		</visual>
		<visual>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/meshes/Link1_rings.stl" />
				</geometry>
			<material name="white"/>
		</visual>
		<collision>
			<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/collision/Link1_body.stl" />
				</geometry>
			<material name="white"/>
		</collision>
		</link>

<!-- ============================ DOF2 ================================= -->

		<joint name="${prefix}joint2" type="revolute">  
			<origin rpy="${R2} ${P2} ${Y2}" xyz="${x2} ${y2} ${z2}" /> 
			<axis xyz="1 0 0" />
			<limit lower="${lower_joint_limit_2}" upper="${upper_joint_limit_2}" effort="${torque_limit_2}" velocity="${joint_velocity_limit_2}" />
			<parent link="${prefix}link1"/>
			<child link="${prefix}link2"/>
		</joint>

		<link name="${prefix}link2"> 
			<inertial> 
				<mass value="${mass_2}" />
				<origin rpy="0 0 0" xyz="${cog_x_2} ${cog_y_2} ${cog_z_2}" />
				<inertia ixx="${i_xx_2}" ixy="${i_xy_2}"  ixz="${i_xz_2}"
										 iyy="${i_yy_2}"  iyz="${i_yz_2}"
														  izz="${i_zz_2}" />
			</inertial>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/meshes/Link2_body.stl"/>
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
				<mesh filename="package://robot_description/lara8/collision/Link2_body.stl"/>
				</geometry>
				<material name="white"/>
			</collision>
		</link>

<!-- ============================ DOF3 ================================= -->

		<joint name="${prefix}joint3" type="revolute">  
			<origin rpy="${R3} ${P3} ${Y3}" xyz="${x3} ${y3} ${z3}" /> 
			<axis xyz="1 0 0" />
			<limit lower="${lower_joint_limit_3}" upper="${upper_joint_limit_3}" effort="${torque_limit_3}" velocity="${joint_velocity_limit_3}" />
			<parent link="${prefix}link2"/>
			<child link="${prefix}link3"/>
		</joint>

		<link name="${prefix}link3"> 
			<inertial> 
				<mass value="${mass_3}" />
				<origin rpy="0 0 0" xyz="${cog_x_3} ${cog_y_3} ${cog_z_3}" />
				<inertia ixx="${i_xx_3}" ixy="${i_xy_3}"  ixz="${i_xz_3}"
										 iyy="${i_yy_3}"  iyz="${i_yz_3}"
														  izz="${i_zz_3}" />
			</inertial>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link3_body.stl" />
				</geometry>
				<material name="white"/>
			</visual>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link3_rings.stl" />
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/collision/Link3_body.stl" />
				</geometry>
				<material name="white"/>
			</collision>
		</link>

<!-- ============================ DOF4 ================================= -->

		<joint name="${prefix}joint4" type="revolute">  
			<origin rpy="${R4} ${P4} ${Y4}" xyz="${x4} ${y4} ${z4}" />
			<axis xyz="0 -1 0" />
			<limit lower="${lower_joint_limit_4}" upper="${upper_joint_limit_4}" effort="${torque_limit_4}" velocity="${joint_velocity_limit_4}" />
			<parent link="${prefix}link3" />
			<child link="${prefix}link4" />
		</joint>

		<link name="${prefix}link4">  
			<inertial> 
				<mass value="${mass_4}" />
				<origin rpy="0 0 0" xyz="${cog_x_4} ${cog_y_4} ${cog_z_4}" />
				<inertia ixx="${i_xx_4}" ixy="${i_xy_4}"  ixz="${i_xz_4}"
										 iyy="${i_yy_4}"  iyz="${i_yz_4}"
													      izz="${i_zz_4}" />
			</inertial>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link4_body.stl"/>
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/collision/Link4_body.stl"/> 
				</geometry>
				<material name="white"/>
			</collision>
		</link>

<!-- ============================ DOF5 ================================= -->

		<joint name="${prefix}joint5" type="revolute">  
			<origin rpy="${R5} ${P5} ${Y5}" xyz="${x5} ${y5} ${z5}" />
			<axis xyz="1 0 0" />
			<limit lower="${lower_joint_limit_5}" upper="${upper_joint_limit_5}" effort="${torque_limit_5}" velocity="${joint_velocity_limit_5}" />
			<parent link="${prefix}link4"/>
			<child link="${prefix}link5"/>
		</joint>

		<link name="${prefix}link5">  
			<inertial> 
				<mass value="${mass_5}" /> 
				<origin rpy="0 0 0" xyz="${cog_x_5} ${cog_y_5} ${cog_z_5}" />
				<inertia ixx="${i_xx_5}" ixy="${i_xy_5}"  ixz="${i_xz_5}"
										 iyy="${i_yy_5}"  iyz="${i_yz_5}"
														  izz="${i_zz_5}" />
			</inertial>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link5_body.stl" />
				</geometry>
				<material name="white"/>
			</visual>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link5_rings.stl" />
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/collision/Link5_body.stl" />
				</geometry>
				<material name="white"/>
			</collision>
		</link>

<!-- ============================ DOF6 ================================= -->
	
		<joint name="${prefix}joint6" type="revolute"> 
			<origin rpy="${R6} ${P6} ${Y6}" xyz="${x6} ${y6} ${z6}" />
			<axis xyz="0 -1 0" />
			<limit lower="${lower_joint_limit_6}" upper="${upper_joint_limit_6}" effort="${torque_limit_6}" velocity="${joint_velocity_limit_6}" />
			<parent link="${prefix}link5"/>
			<child link="${prefix}link6"/>
		</joint>

		<link name="${prefix}link6">  
			<inertial> 
				<mass value="${mass_6}" />
				<origin rpy="0 0 0" xyz="${cog_x_6} ${cog_y_6} ${cog_z_6}" />
				<inertia ixx="${i_xx_6}" ixy="${i_xy_6}"  ixz="${i_xz_6}"
										 iyy="${i_yy_6}"  iyz="${i_yz_6}"
														  izz="${i_zz_6}" />
			</inertial>
			<visual>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/meshes/Link6_body.stl"/>
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<origin rpy="0 0 0" xyz="0 0 0" />
				<geometry>
					<mesh filename="package://robot_description/lara8/collision/Link6_body.stl"/>
				</geometry>
				<material name="white"/>
			</collision>
		</link> 

<!-- ============================ Flange ================================= -->

		<link name = "${prefix}flange"/>
		<joint name="${prefix}link6_to_flange" type="fixed">
   			<origin rpy="${R7} ${P7} ${Y7}" xyz="${x7} ${y7} ${z7}" />
			<parent link="${prefix}link6"/>
			<child link="${prefix}flange"/>
		</joint> 


<!-- ============================ Camera ================================= -->
  <xacro:if value="${use_vision}"> 
   <link name="camera_link">
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <box size='0.01 0.01 0.01'/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <box size='0.1 0.1 0.1'/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0.000 0.0 0.0" rpy="0 0 0"/>
        <mass value="0.4"/>
        <inertia ixx="0.05"  ixy="0"  ixz="0" iyy="0.018" iyz="0" izz="0.044" />
      </inertial>
    </link>  


    <link name="camera_link_optical">
	 <mass value="5.0" /> <origin rpy="0 0 0" xyz="0 0 0" />
        <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1" />
	</link>
  
  

    <joint name="camera_joint" type="fixed">
      <parent link="${prefix}flange"/>
      <child link="camera_link"/>
      <origin xyz="0 0 0" rpy="0 -1.57 3.14"/>
    </joint>

    <joint name="camera_optical_joint" type="fixed">
      <parent link="camera_link"/>
      <child link="camera_link_optical"/>
      <origin xyz="0 0 0" rpy="${-pi/2} 0 ${-pi/2}"/>
    </joint>
    
    
    <xacro:include filename="$(find robot_description)/lara8/urdf/camera.xacro"/>


    <gazebo>
      <plugin filename="gz-sim-sensors-system"
      name="gz::sim::systems::Sensors">
      <render_engine>ogre2</render_engine>
      </plugin>
    </gazebo>

    <xacro:camera link="camera_link"/>

</xacro:if>

<!-- ============================================================= -->



	</xacro:macro>
</robot>
